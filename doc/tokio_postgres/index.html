<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="An asynchronous, pipelined, PostgreSQL client."><title>tokio_postgres - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-fa3bb1812debf86c.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="tokio_postgres" data-themes="" data-resource-suffix="" data-rustdoc-version="1.74.1 (a28077b28 2023-12-04)" data-channel="1.74.1" data-search-js="search-8be46b629f5f14a8.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-c5bd66d33317d69f.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../tokio_postgres/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a></nav><nav class="sidebar"><a class="logo-container" href="../tokio_postgres/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate tokio_postgres</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.7.7</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">tokio_postgres</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/tokio_postgres/lib.rs.html#1-256">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>An asynchronous, pipelined, PostgreSQL client.</p>
<h2 id="example"><a href="#example">Example</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>tokio_postgres::{NoTls, Error};

<span class="attr">#[tokio::main] </span><span class="comment">// By default, tokio_postgres uses the tokio crate as its runtime.
</span><span class="kw">async fn </span>main() -&gt; <span class="prelude-ty">Result</span>&lt;(), Error&gt; {
    <span class="comment">// Connect to the database.
    </span><span class="kw">let </span>(client, connection) =
        tokio_postgres::connect(<span class="string">&quot;host=localhost user=postgres&quot;</span>, NoTls).<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// The connection object performs the actual communication with the database,
    // so spawn it off to run on its own.
    </span>tokio::spawn(<span class="kw">async move </span>{
        <span class="kw">if let </span><span class="prelude-val">Err</span>(e) = connection.<span class="kw">await </span>{
            <span class="macro">eprintln!</span>(<span class="string">&quot;connection error: {}&quot;</span>, e);
        }
    });

    <span class="comment">// Now we can execute a simple statement that just returns its parameter.
    </span><span class="kw">let </span>rows = client
        .query(<span class="string">&quot;SELECT $1::TEXT&quot;</span>, <span class="kw-2">&amp;</span>[<span class="kw-2">&amp;</span><span class="string">&quot;hello world&quot;</span>])
        .<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// And then check that we got back the same string we sent over.
    </span><span class="kw">let </span>value: <span class="kw-2">&amp;</span>str = rows[<span class="number">0</span>].get(<span class="number">0</span>);
    <span class="macro">assert_eq!</span>(value, <span class="string">&quot;hello world&quot;</span>);

    <span class="prelude-val">Ok</span>(())
}</code></pre></div>
<h2 id="behavior"><a href="#behavior">Behavior</a></h2>
<p>Calling a method like <code>Client::query</code> on its own does nothing. The associated request is not sent to the database
until the future returned by the method is first polled. Requests are executed in the order that they are first
polled, not in the order that their futures are created.</p>
<h2 id="pipelining"><a href="#pipelining">Pipelining</a></h2>
<p>The client supports <em>pipelined</em> requests. Pipelining can improve performance in use cases in which multiple,
independent queries need to be executed. In a traditional workflow, each query is sent to the server after the
previous query completes. In contrast, pipelining allows the client to send all of the queries to the server up
front, minimizing time spent by one side waiting for the other to finish sending data:</p>
<div class="example-wrap"><pre class="language-not_rust"><code>            Sequential                              Pipelined
| Client         | Server          |    | Client         | Server          |
|----------------|-----------------|    |----------------|-----------------|
| send query 1   |                 |    | send query 1   |                 |
|                | process query 1 |    | send query 2   | process query 1 |
| receive rows 1 |                 |    | send query 3   | process query 2 |
| send query 2   |                 |    | receive rows 1 | process query 3 |
|                | process query 2 |    | receive rows 2 |                 |
| receive rows 2 |                 |    | receive rows 3 |                 |
| send query 3   |                 |
|                | process query 3 |
| receive rows 3 |                 |
</code></pre></div>
<p>In both cases, the PostgreSQL server is executing the queries sequentially - pipelining just allows both sides of
the connection to work concurrently when possible.</p>
<p>Pipelining happens automatically when futures are polled concurrently (for example, by using the futures <code>join</code>
combinator):</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>futures_util::future;
<span class="kw">use </span>std::future::Future;
<span class="kw">use </span>tokio_postgres::{Client, Error, Statement};

<span class="kw">async fn </span>pipelined_prepare(
    client: <span class="kw-2">&amp;</span>Client,
) -&gt; <span class="prelude-ty">Result</span>&lt;(Statement, Statement), Error&gt;
{
    future::try_join(
        client.prepare(<span class="string">&quot;SELECT * FROM foo&quot;</span>),
        client.prepare(<span class="string">&quot;INSERT INTO bar (id, name) VALUES ($1, $2)&quot;</span>)
    ).<span class="kw">await
</span>}</code></pre></div>
<h2 id="runtime"><a href="#runtime">Runtime</a></h2>
<p>The client works with arbitrary <code>AsyncRead + AsyncWrite</code> streams. Convenience APIs are provided to handle the
connection process, but these are gated by the <code>runtime</code> Cargo feature, which is enabled by default. If disabled,
all dependence on the tokio runtime is removed.</p>
<h2 id="ssltls-support"><a href="#ssltls-support">SSL/TLS support</a></h2>
<p>TLS support is implemented via external libraries. <code>Client::connect</code> and <code>Config::connect</code> take a TLS implementation
as an argument. The <code>NoTls</code> type in this crate can be used when TLS is not required. Otherwise, the
<code>postgres-openssl</code> and <code>postgres-native-tls</code> crates provide implementations backed by the <code>openssl</code> and <code>native-tls</code>
crates, respectively.</p>
<h2 id="features"><a href="#features">Features</a></h2>
<p>The following features can be enabled from <code>Cargo.toml</code>:</p>
<div><table><thead><tr><th>Feature</th><th>Description</th><th>Extra dependencies</th><th>Default</th></tr></thead><tbody>
<tr><td><code>runtime</code></td><td>Enable convenience API for the connection process based on the <code>tokio</code> crate.</td><td><a href="https://crates.io/crates/tokio">tokio</a> 1.0 with the features <code>net</code> and <code>time</code></td><td>yes</td></tr>
<tr><td><code>array-impls</code></td><td>Enables <code>ToSql</code> and <code>FromSql</code> trait impls for arrays</td><td>-</td><td>no</td></tr>
<tr><td><code>with-bit-vec-0_6</code></td><td>Enable support for the <code>bit-vec</code> crate.</td><td><a href="https://crates.io/crates/bit-vec">bit-vec</a> 0.6</td><td>no</td></tr>
<tr><td><code>with-chrono-0_4</code></td><td>Enable support for the <code>chrono</code> crate.</td><td><a href="https://crates.io/crates/chrono">chrono</a> 0.4</td><td>no</td></tr>
<tr><td><code>with-eui48-0_4</code></td><td>Enable support for the 0.4 version of the <code>eui48</code> crate.</td><td><a href="https://crates.io/crates/eui48">eui48</a> 0.4</td><td>no</td></tr>
<tr><td><code>with-eui48-1</code></td><td>Enable support for the 1.0 version of the <code>eui48</code> crate.</td><td><a href="https://crates.io/crates/eui48">eui48</a> 1.0</td><td>no</td></tr>
<tr><td><code>with-geo-types-0_6</code></td><td>Enable support for the 0.6 version of the <code>geo-types</code> crate.</td><td><a href="https://crates.io/crates/geo-types/0.6.0">geo-types</a> 0.6</td><td>no</td></tr>
<tr><td><code>with-geo-types-0_7</code></td><td>Enable support for the 0.7 version of the <code>geo-types</code> crate.</td><td><a href="https://crates.io/crates/geo-types/0.7.0">geo-types</a> 0.7</td><td>no</td></tr>
<tr><td><code>with-serde_json-1</code></td><td>Enable support for the <code>serde_json</code> crate.</td><td><a href="https://crates.io/crates/serde_json">serde_json</a> 1.0</td><td>no</td></tr>
<tr><td><code>with-uuid-0_8</code></td><td>Enable support for the <code>uuid</code> crate.</td><td><a href="https://crates.io/crates/uuid">uuid</a> 0.8</td><td>no</td></tr>
<tr><td><code>with-uuid-1</code></td><td>Enable support for the <code>uuid</code> crate.</td><td><a href="https://crates.io/crates/uuid">uuid</a> 1.0</td><td>no</td></tr>
<tr><td><code>with-time-0_2</code></td><td>Enable support for the 0.2 version of the <code>time</code> crate.</td><td><a href="https://crates.io/crates/time/0.2.0">time</a> 0.2</td><td>no</td></tr>
<tr><td><code>with-time-0_3</code></td><td>Enable support for the 0.3 version of the <code>time</code> crate.</td><td><a href="https://crates.io/crates/time/0.3.0">time</a> 0.3</td><td>no</td></tr>
</tbody></table>
</div></div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.Config"><code>pub use crate::config::<a class="struct" href="config/struct.Config.html" title="struct tokio_postgres::config::Config">Config</a>;</code></div></li><li><div class="item-name" id="reexport.Error"><code>pub use crate::error::<a class="struct" href="error/struct.Error.html" title="struct tokio_postgres::error::Error">Error</a>;</code></div></li><li><div class="item-name" id="reexport.Row"><code>pub use crate::row::<a class="struct" href="row/struct.Row.html" title="struct tokio_postgres::row::Row">Row</a>;</code></div></li><li><div class="item-name" id="reexport.SimpleQueryRow"><code>pub use crate::row::<a class="struct" href="row/struct.SimpleQueryRow.html" title="struct tokio_postgres::row::SimpleQueryRow">SimpleQueryRow</a>;</code></div></li><li><div class="item-name" id="reexport.NoTls"><code>pub use crate::tls::<a class="struct" href="tls/struct.NoTls.html" title="struct tokio_postgres::tls::NoTls">NoTls</a>;</code></div></li></ul><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="binary_copy/index.html" title="mod tokio_postgres::binary_copy">binary_copy</a></div><div class="desc docblock-short">Utilities for working with the PostgreSQL binary copy format.</div></li><li><div class="item-name"><a class="mod" href="config/index.html" title="mod tokio_postgres::config">config</a></div><div class="desc docblock-short">Connection configuration.</div></li><li><div class="item-name"><a class="mod" href="error/index.html" title="mod tokio_postgres::error">error</a></div><div class="desc docblock-short">Errors.</div></li><li><div class="item-name"><a class="mod" href="row/index.html" title="mod tokio_postgres::row">row</a></div><div class="desc docblock-short">Rows.</div></li><li><div class="item-name"><a class="mod" href="tls/index.html" title="mod tokio_postgres::tls">tls</a></div><div class="desc docblock-short">TLS support.</div></li><li><div class="item-name"><a class="mod" href="types/index.html" title="mod tokio_postgres::types">types</a></div><div class="desc docblock-short">Types.</div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.CancelToken.html" title="struct tokio_postgres::CancelToken">CancelToken</a></div><div class="desc docblock-short">The capability to request cancellation of in-progress queries on a
connection.</div></li><li><div class="item-name"><a class="struct" href="struct.Client.html" title="struct tokio_postgres::Client">Client</a></div><div class="desc docblock-short">An asynchronous PostgreSQL client.</div></li><li><div class="item-name"><a class="struct" href="struct.Column.html" title="struct tokio_postgres::Column">Column</a></div><div class="desc docblock-short">Information about a column of a query.</div></li><li><div class="item-name"><a class="struct" href="struct.Connection.html" title="struct tokio_postgres::Connection">Connection</a></div><div class="desc docblock-short">A connection to a PostgreSQL database.</div></li><li><div class="item-name"><a class="struct" href="struct.CopyInSink.html" title="struct tokio_postgres::CopyInSink">CopyInSink</a></div><div class="desc docblock-short">A sink for <code>COPY ... FROM STDIN</code> query data.</div></li><li><div class="item-name"><a class="struct" href="struct.CopyOutStream.html" title="struct tokio_postgres::CopyOutStream">CopyOutStream</a></div><div class="desc docblock-short">A stream of <code>COPY ... TO STDOUT</code> query data.</div></li><li><div class="item-name"><a class="struct" href="struct.Notification.html" title="struct tokio_postgres::Notification">Notification</a></div><div class="desc docblock-short">An asynchronous notification.</div></li><li><div class="item-name"><a class="struct" href="struct.Portal.html" title="struct tokio_postgres::Portal">Portal</a></div><div class="desc docblock-short">A portal.</div></li><li><div class="item-name"><a class="struct" href="struct.RowStream.html" title="struct tokio_postgres::RowStream">RowStream</a></div><div class="desc docblock-short">A stream of table rows.</div></li><li><div class="item-name"><a class="struct" href="struct.SimpleQueryStream.html" title="struct tokio_postgres::SimpleQueryStream">SimpleQueryStream</a></div><div class="desc docblock-short">A stream of simple query results.</div></li><li><div class="item-name"><a class="struct" href="struct.Socket.html" title="struct tokio_postgres::Socket">Socket</a></div><div class="desc docblock-short">The standard stream type used by the crate.</div></li><li><div class="item-name"><a class="struct" href="struct.Statement.html" title="struct tokio_postgres::Statement">Statement</a></div><div class="desc docblock-short">A prepared statement.</div></li><li><div class="item-name"><a class="struct" href="struct.Transaction.html" title="struct tokio_postgres::Transaction">Transaction</a></div><div class="desc docblock-short">A representation of a PostgreSQL database transaction.</div></li><li><div class="item-name"><a class="struct" href="struct.TransactionBuilder.html" title="struct tokio_postgres::TransactionBuilder">TransactionBuilder</a></div><div class="desc docblock-short">A builder for database transactions.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.AsyncMessage.html" title="enum tokio_postgres::AsyncMessage">AsyncMessage</a></div><div class="desc docblock-short">An asynchronous message from the server.</div></li><li><div class="item-name"><a class="enum" href="enum.IsolationLevel.html" title="enum tokio_postgres::IsolationLevel">IsolationLevel</a></div><div class="desc docblock-short">The isolation level of a database transaction.</div></li><li><div class="item-name"><a class="enum" href="enum.SimpleQueryMessage.html" title="enum tokio_postgres::SimpleQueryMessage">SimpleQueryMessage</a></div><div class="desc docblock-short">Message returned by the <code>SimpleQuery</code> stream.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.GenericClient.html" title="trait tokio_postgres::GenericClient">GenericClient</a></div><div class="desc docblock-short">A trait allowing abstraction over connections and transactions.</div></li><li><div class="item-name"><a class="trait" href="trait.ToStatement.html" title="trait tokio_postgres::ToStatement">ToStatement</a></div><div class="desc docblock-short">A trait abstracting over prepared and unprepared statements.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.connect.html" title="fn tokio_postgres::connect">connect</a></div><div class="desc docblock-short">A convenience function which parses a connection string and connects to the database.</div></li></ul></section></div></main></body></html>