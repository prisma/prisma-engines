<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The OTLP Exporter supports exporting trace and metric data in the OTLP format to the OpenTelemetry collector or other compatible backend."><title>opentelemetry_otlp - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-cb6f1f67f1bcd037.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="opentelemetry_otlp" data-themes="" data-resource-suffix="" data-rustdoc-version="1.73.0 (cc66ad468 2023-10-03) (built from a source tarball)" data-channel="1.73.0" data-search-js="search-6dfdfced5eff6596.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-1596385f77d47ef2.css" data-theme-dark-css="dark-0a43001d3fc2282c.css" data-theme-ayu-css="ayu-fd19013d6ce078bf.css" ><script src="../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-0795b7d26be81095.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../static.files/light-1596385f77d47ef2.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../static.files/dark-0a43001d3fc2282c.css"><link rel="stylesheet" href="../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../opentelemetry_otlp/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../opentelemetry_otlp/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate opentelemetry_otlp</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.10.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">opentelemetry_otlp</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/opentelemetry_otlp/lib.rs.html#1-381">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>The OTLP Exporter supports exporting trace and metric data in the OTLP
format to the OpenTelemetry collector or other compatible backend.</p>
<p>The OpenTelemetry Collector offers a vendor-agnostic implementation on how
to receive, process, and export telemetry data. In addition, it removes
the need to run, operate, and maintain multiple agents/collectors in
order to support open-source telemetry data formats (e.g. Jaeger,
Prometheus, etc.) sending to multiple open-source or commercial back-ends.</p>
<p>Currently, this crate only support sending tracing data or metrics in OTLP
via grpc and http(in binary format). Supports for other format and protocol
will be added in the future. The details of what’s currently offering in this
crate can be found in this doc.</p>
<h2 id="quickstart"><a href="#quickstart">Quickstart</a></h2>
<p>First make sure you have a running version of the opentelemetry collector
you want to send data to:</p>
<div class="example-wrap"><pre class="language-shell"><code>$ docker run -p 4317:4317 otel/opentelemetry-collector-dev:latest
</code></pre></div>
<p>Then install a new pipeline with the recommended defaults to start exporting
telemetry. You will have to build a OTLP exporter first.</p>
<p>Tracing and metrics pipelines can be started with <code>new_pipeline().tracing()</code> and
<code>new_pipeline().metrics()</code> respectively.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>opentelemetry::trace::Tracer;

<span class="kw">fn </span>main() -&gt; <span class="prelude-ty">Result</span>&lt;(), Box&lt;<span class="kw">dyn </span>std::error::Error + Send + Sync + <span class="lifetime">&#39;static</span>&gt;&gt; {
    <span class="comment">// First, create a OTLP exporter builder. Configure it as you need.
    </span><span class="kw">let </span>otlp_exporter = opentelemetry_otlp::new_exporter().tonic();
    <span class="comment">// Then pass it into pipeline builder
    </span><span class="kw">let </span>tracer = opentelemetry_otlp::new_pipeline()
            .tracing()
            .with_exporter(otlp_exporter)
            .install_simple()<span class="question-mark">?</span>;

    tracer.in_span(<span class="string">&quot;doing_work&quot;</span>, |cx| {
        <span class="comment">// Traced app logic here...
    </span>});

    <span class="prelude-val">Ok</span>(())
}</code></pre></div>
<h3 id="performance"><a href="#performance">Performance</a></h3>
<p>For optimal performance, a batch exporter is recommended as the simple
exporter will export each span synchronously on dropping. You can enable the
[<code>rt-tokio</code>], [<code>rt-tokio-current-thread</code>] or [<code>rt-async-std</code>] features and
specify a runtime on the pipeline builder to have a batch exporter
configured for you automatically.</p>
<div class="example-wrap"><pre class="language-toml"><code>[dependencies]
opentelemetry = { version = &quot;*&quot;, features = [&quot;async-std&quot;] }
opentelemetry-otlp = { version = &quot;*&quot;, features = [&quot;grpc-sys&quot;] }
</code></pre></div>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>tracer = opentelemetry_otlp::new_pipeline()
    .tracing()
    .with_exporter(opentelemetry_otlp::new_exporter().tonic())
    .install_batch(opentelemetry::runtime::AsyncStd)<span class="question-mark">?</span>;</code></pre></div>
<h2 id="kitchen-sink-full-configuration"><a href="#kitchen-sink-full-configuration">Kitchen Sink Full Configuration</a></h2>
<p>Example showing how to override all configuration options.</p>
<p>Generally there are two parts of configuration. One is metrics config
or tracing config. Users can config it via <a href="struct.OtlpTracePipeline.html" title="struct opentelemetry_otlp::OtlpTracePipeline"><code>OtlpTracePipeline</code></a>
or [<code>OtlpMetricPipeline</code>]. The other is exporting configuration.
Users can set those configurations using <a href="struct.OtlpExporterPipeline.html" title="struct opentelemetry_otlp::OtlpExporterPipeline"><code>OtlpExporterPipeline</code></a> based
on the choice of exporters.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>opentelemetry::{KeyValue, trace::Tracer};
<span class="kw">use </span>opentelemetry::sdk::{trace::{<span class="self">self</span>, IdGenerator, Sampler}, Resource};
<span class="kw">use </span>opentelemetry::sdk::metrics::{selectors, PushController};
<span class="kw">use </span>opentelemetry::util::tokio_interval_stream;
<span class="kw">use </span>opentelemetry_otlp::{Protocol, WithExportConfig, ExportConfig};
<span class="kw">use </span>std::time::Duration;
<span class="kw">use </span>tonic::metadata::<span class="kw-2">*</span>;

<span class="kw">fn </span>main() -&gt; <span class="prelude-ty">Result</span>&lt;(), Box&lt;<span class="kw">dyn </span>std::error::Error + Send + Sync + <span class="lifetime">&#39;static</span>&gt;&gt; {
    <span class="kw">let </span><span class="kw-2">mut </span>map = MetadataMap::with_capacity(<span class="number">3</span>);

    map.insert(<span class="string">&quot;x-host&quot;</span>, <span class="string">&quot;example.com&quot;</span>.parse().unwrap());
    map.insert(<span class="string">&quot;x-number&quot;</span>, <span class="string">&quot;123&quot;</span>.parse().unwrap());
    map.insert_bin(<span class="string">&quot;trace-proto-bin&quot;</span>, MetadataValue::from_bytes(<span class="string">b&quot;[binary data]&quot;</span>));

    <span class="kw">let </span>tracer = opentelemetry_otlp::new_pipeline()
        .tracing()
        .with_exporter(
            opentelemetry_otlp::new_exporter()
            .tonic()
            .with_endpoint(<span class="string">&quot;http://localhost:4317&quot;</span>)
            .with_timeout(Duration::from_secs(<span class="number">3</span>))
            .with_metadata(map)
         )
        .with_trace_config(
            trace::config()
                .with_sampler(Sampler::AlwaysOn)
                .with_id_generator(IdGenerator::default())
                .with_max_events_per_span(<span class="number">64</span>)
                .with_max_attributes_per_span(<span class="number">16</span>)
                .with_max_events_per_span(<span class="number">16</span>)
                .with_resource(Resource::new(<span class="macro">vec!</span>[KeyValue::new(<span class="string">&quot;service.name&quot;</span>, <span class="string">&quot;example&quot;</span>)])),
        )
        .install_batch(opentelemetry::runtime::Tokio)<span class="question-mark">?</span>;

    <span class="kw">let </span>export_config = ExportConfig {
        endpoint: <span class="string">&quot;http://localhost:4317&quot;</span>.to_string(),
        timeout: Duration::from_secs(<span class="number">3</span>),
        protocol: Protocol::Grpc
    };

    <span class="kw">let </span>meter = opentelemetry_otlp::new_pipeline()
        .metrics(tokio::spawn, tokio_interval_stream)
        .with_exporter(
            opentelemetry_otlp::new_exporter()
                .tonic()
                .with_export_config(export_config),
                <span class="comment">// can also config it using with_* functions like the tracing part above.
        </span>)
        .with_stateful(<span class="bool-val">true</span>)
        .with_period(Duration::from_secs(<span class="number">3</span>))
        .with_timeout(Duration::from_secs(<span class="number">10</span>))
        .with_aggregator_selector(selectors::simple::Selector::Exact)
        .build();

    tracer.in_span(<span class="string">&quot;doing_work&quot;</span>, |cx| {
        <span class="comment">// Traced app logic here...
    </span>});

    <span class="prelude-val">Ok</span>(())
}</code></pre></div>
<h2 id="grpc-libraries-comparison"><a href="#grpc-libraries-comparison">Grpc libraries comparison</a></h2>
<p>The table below provides a short comparison between <code>grpcio</code> and <code>tonic</code>, two
of the most popular grpc libraries in Rust. Users can choose between them when
working with otlp and grpc.</p>
<div><table><thead><tr><th>Project</th><th><a href="https://github.com/hyperium/tonic">hyperium/tonic</a></th><th><a href="https://github.com/tikv/grpc-rs">tikv/grpc-rs</a></th></tr></thead><tbody>
<tr><td>Feature name</td><td>–features=default</td><td>–features=grpc-sys</td></tr>
<tr><td>gRPC library</td><td><a href="https://crates.io/crates/tonic"><code>tonic</code></a></td><td><a href="https://crates.io/crates/grpcio"><code>grpcio</code></a></td></tr>
<tr><td>Transport</td><td><a href="https://github.com/hyperium/hyper">hyperium/hyper</a> (Rust)</td><td><a href="https://github.com/grpc/grpc">grpc/grpc</a> (C++ binding)</td></tr>
<tr><td>TLS support</td><td>yes</td><td>yes</td></tr>
<tr><td>TLS optional</td><td>yes</td><td>yes</td></tr>
<tr><td>TLS library</td><td>rustls</td><td>OpenSSL</td></tr>
<tr><td>Supported .proto generator</td><td><a href="https://crates.io/crates/prost"><code>prost</code></a></td><td><a href="https://crates.io/crates/prost"><code>prost</code></a>, <a href="https://crates.io/crates/protobuf"><code>protobuf</code></a></td></tr>
</tbody></table>
</div></div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.ExportConfig.html" title="struct opentelemetry_otlp::ExportConfig">ExportConfig</a></div><div class="desc docblock-short">Configuration for the OTLP exporter.</div></li><li><div class="item-name"><a class="struct" href="struct.OtlpExporterPipeline.html" title="struct opentelemetry_otlp::OtlpExporterPipeline">OtlpExporterPipeline</a></div><div class="desc docblock-short">Build a OTLP metrics or tracing exporter builder. See functions below to understand
what’s currently supported.</div></li><li><div class="item-name"><a class="struct" href="struct.OtlpPipeline.html" title="struct opentelemetry_otlp::OtlpPipeline">OtlpPipeline</a></div><div class="desc docblock-short">General builder for both tracing and metrics.</div></li><li><div class="item-name"><a class="struct" href="struct.OtlpTracePipeline.html" title="struct opentelemetry_otlp::OtlpTracePipeline">OtlpTracePipeline</a></div><div class="desc docblock-short">Recommended configuration for an OTLP exporter pipeline.</div></li><li><div class="item-name"><a class="struct" href="struct.TonicExporterBuilder.html" title="struct opentelemetry_otlp::TonicExporterBuilder">TonicExporterBuilder</a></div><div class="desc docblock-short">Build a trace exporter that uses <a href="https://github.com/hyperium/tonic">tonic</a> as grpc layer and opentelemetry protocol.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.Error.html" title="enum opentelemetry_otlp::Error">Error</a></div><div class="desc docblock-short">Wrap type for errors from this crate.</div></li><li><div class="item-name"><a class="enum" href="enum.Protocol.html" title="enum opentelemetry_otlp::Protocol">Protocol</a></div><div class="desc docblock-short">The communication protocol to use when exporting data.</div></li><li><div class="item-name"><a class="enum" href="enum.SpanExporter.html" title="enum opentelemetry_otlp::SpanExporter">SpanExporter</a></div><div class="desc docblock-short">OTLP exporter that sends tracing information</div></li><li><div class="item-name"><a class="enum" href="enum.SpanExporterBuilder.html" title="enum opentelemetry_otlp::SpanExporterBuilder">SpanExporterBuilder</a></div><div class="desc docblock-short">OTLP span exporter builder.</div></li></ul><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.OTEL_EXPORTER_OTLP_ENDPOINT.html" title="constant opentelemetry_otlp::OTEL_EXPORTER_OTLP_ENDPOINT">OTEL_EXPORTER_OTLP_ENDPOINT</a></div><div class="desc docblock-short">Target to which the exporter is going to send spans or metrics, defaults to https://localhost:4317.</div></li><li><div class="item-name"><a class="constant" href="constant.OTEL_EXPORTER_OTLP_ENDPOINT_DEFAULT.html" title="constant opentelemetry_otlp::OTEL_EXPORTER_OTLP_ENDPOINT_DEFAULT">OTEL_EXPORTER_OTLP_ENDPOINT_DEFAULT</a></div><div class="desc docblock-short">Default target to which the exporter is going to send spans or metrics.</div></li><li><div class="item-name"><a class="constant" href="constant.OTEL_EXPORTER_OTLP_TIMEOUT.html" title="constant opentelemetry_otlp::OTEL_EXPORTER_OTLP_TIMEOUT">OTEL_EXPORTER_OTLP_TIMEOUT</a></div><div class="desc docblock-short">Max waiting time for the backend to process each spans or metrics batch, defaults to 10 seconds.</div></li><li><div class="item-name"><a class="constant" href="constant.OTEL_EXPORTER_OTLP_TIMEOUT_DEFAULT.html" title="constant opentelemetry_otlp::OTEL_EXPORTER_OTLP_TIMEOUT_DEFAULT">OTEL_EXPORTER_OTLP_TIMEOUT_DEFAULT</a></div><div class="desc docblock-short">Default max waiting time for the backend to process each spans or metrics batch.</div></li><li><div class="item-name"><a class="constant" href="constant.OTEL_EXPORTER_OTLP_TRACES_ENDPOINT.html" title="constant opentelemetry_otlp::OTEL_EXPORTER_OTLP_TRACES_ENDPOINT">OTEL_EXPORTER_OTLP_TRACES_ENDPOINT</a></div><div class="desc docblock-short">Target to which the exporter is going to send spans, defaults to https://localhost:4317.</div></li><li><div class="item-name"><a class="constant" href="constant.OTEL_EXPORTER_OTLP_TRACES_TIMEOUT.html" title="constant opentelemetry_otlp::OTEL_EXPORTER_OTLP_TRACES_TIMEOUT">OTEL_EXPORTER_OTLP_TRACES_TIMEOUT</a></div><div class="desc docblock-short">Max waiting time for the backend to process each spans batch, defaults to 10s.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.HasExportConfig.html" title="trait opentelemetry_otlp::HasExportConfig">HasExportConfig</a></div><div class="desc docblock-short">Provide access to the export config field within the exporter builders.</div></li><li><div class="item-name"><a class="trait" href="trait.WithExportConfig.html" title="trait opentelemetry_otlp::WithExportConfig">WithExportConfig</a></div><div class="desc docblock-short">Expose methods to override export configuration.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.new_exporter.html" title="fn opentelemetry_otlp::new_exporter">new_exporter</a></div><div class="desc docblock-short">Create a builder to build OTLP metrics exporter or tracing exporter.</div></li><li><div class="item-name"><a class="fn" href="fn.new_pipeline.html" title="fn opentelemetry_otlp::new_pipeline">new_pipeline</a></div><div class="desc docblock-short">Create a new pipeline builder with the recommended configuration.</div></li></ul></section></div></main></body></html>