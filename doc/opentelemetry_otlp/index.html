<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The OTLP Exporter supports exporting trace and metric data in the OTLP format to the OpenTelemetry collector or other compatible backend."><meta name="keywords" content="rust, rustlang, rust-lang, opentelemetry_otlp"><title>opentelemetry_otlp - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script defer src="../crates.js"></script><script defer src="../main.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../opentelemetry_otlp/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../opentelemetry_otlp/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Crate opentelemetry_otlp</a></h2><div class="sidebar-elems"><div class="block"><ul><li class="version">Version 0.10.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul></div><section><div class="block"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../opentelemetry_otlp/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><div id="settings-menu" tabindex="-1">
                                <a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div>
                        </div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">opentelemetry_otlp</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/opentelemetry_otlp/lib.rs.html#1-381">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>The OTLP Exporter supports exporting trace and metric data in the OTLP
format to the OpenTelemetry collector or other compatible backend.</p>
<p>The OpenTelemetry Collector offers a vendor-agnostic implementation on how
to receive, process, and export telemetry data. In addition, it removes
the need to run, operate, and maintain multiple agents/collectors in
order to support open-source telemetry data formats (e.g. Jaeger,
Prometheus, etc.) sending to multiple open-source or commercial back-ends.</p>
<p>Currently, this crate only support sending tracing data or metrics in OTLP
via grpc and http(in binary format). Supports for other format and protocol
will be added in the future. The details of what’s currently offering in this
crate can be found in this doc.</p>
<h2 id="quickstart"><a href="#quickstart">Quickstart</a></h2>
<p>First make sure you have a running version of the opentelemetry collector
you want to send data to:</p>
<div class="example-wrap"><pre class="language-shell"><code>$ docker run -p 4317:4317 otel/opentelemetry-collector-dev:latest</code></pre></div>
<p>Then install a new pipeline with the recommended defaults to start exporting
telemetry. You will have to build a OTLP exporter first.</p>
<p>Tracing and metrics pipelines can be started with <code>new_pipeline().tracing()</code> and
<code>new_pipeline().metrics()</code> respectively.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">opentelemetry::trace::Tracer</span>;

<span class="kw">fn</span> <span class="ident">main</span>() -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span>(), <span class="ident">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="ident">std::error::Error</span> <span class="op">+</span> <span class="ident">Send</span> <span class="op">+</span> <span class="ident">Sync</span> <span class="op">+</span> <span class="lifetime">&#39;static</span><span class="op">&gt;</span><span class="op">&gt;</span> {
    <span class="comment">// First, create a OTLP exporter builder. Configure it as you need.</span>
    <span class="kw">let</span> <span class="ident">otlp_exporter</span> <span class="op">=</span> <span class="ident">opentelemetry_otlp::new_exporter</span>().<span class="ident">tonic</span>();
    <span class="comment">// Then pass it into pipeline builder</span>
    <span class="kw">let</span> <span class="ident">tracer</span> <span class="op">=</span> <span class="ident">opentelemetry_otlp::new_pipeline</span>()
            .<span class="ident">tracing</span>()
            .<span class="ident">with_exporter</span>(<span class="ident">otlp_exporter</span>)
            .<span class="ident">install_simple</span>()<span class="question-mark">?</span>;

    <span class="ident">tracer</span>.<span class="ident">in_span</span>(<span class="string">&quot;doing_work&quot;</span>, <span class="op">|</span><span class="ident">cx</span><span class="op">|</span> {
        <span class="comment">// Traced app logic here...</span>
    });

    <span class="prelude-val">Ok</span>(())
}</code></pre></div>
<h3 id="performance"><a href="#performance">Performance</a></h3>
<p>For optimal performance, a batch exporter is recommended as the simple
exporter will export each span synchronously on dropping. You can enable the
[<code>rt-tokio</code>], [<code>rt-tokio-current-thread</code>] or [<code>rt-async-std</code>] features and
specify a runtime on the pipeline builder to have a batch exporter
configured for you automatically.</p>
<div class="example-wrap"><pre class="language-toml"><code>[dependencies]
opentelemetry = { version = &quot;*&quot;, features = [&quot;async-std&quot;] }
opentelemetry-otlp = { version = &quot;*&quot;, features = [&quot;grpc-sys&quot;] }</code></pre></div>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let</span> <span class="ident">tracer</span> <span class="op">=</span> <span class="ident">opentelemetry_otlp::new_pipeline</span>()
    .<span class="ident">tracing</span>()
    .<span class="ident">with_exporter</span>(<span class="ident">opentelemetry_otlp::new_exporter</span>().<span class="ident">tonic</span>())
    .<span class="ident">install_batch</span>(<span class="ident">opentelemetry::runtime::AsyncStd</span>)<span class="question-mark">?</span>;</code></pre></div>
<h2 id="kitchen-sink-full-configuration"><a href="#kitchen-sink-full-configuration">Kitchen Sink Full Configuration</a></h2>
<p>Example showing how to override all configuration options.</p>
<p>Generally there are two parts of configuration. One is metrics config
or tracing config. Users can config it via <a href="struct.OtlpTracePipeline.html" title="OtlpTracePipeline"><code>OtlpTracePipeline</code></a>
or [<code>OtlpMetricPipeline</code>]. The other is exporting configuration.
Users can set those configurations using <a href="struct.OtlpExporterPipeline.html" title="OtlpExporterPipeline"><code>OtlpExporterPipeline</code></a> based
on the choice of exporters.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">opentelemetry</span>::{<span class="ident">KeyValue</span>, <span class="ident">trace::Tracer</span>};
<span class="kw">use</span> <span class="ident">opentelemetry::sdk</span>::{<span class="ident">trace</span>::{<span class="self">self</span>, <span class="ident">IdGenerator</span>, <span class="ident">Sampler</span>}, <span class="ident">Resource</span>};
<span class="kw">use</span> <span class="ident">opentelemetry::sdk::metrics</span>::{<span class="ident">selectors</span>, <span class="ident">PushController</span>};
<span class="kw">use</span> <span class="ident">opentelemetry::util::tokio_interval_stream</span>;
<span class="kw">use</span> <span class="ident">opentelemetry_otlp</span>::{<span class="ident">Protocol</span>, <span class="ident">WithExportConfig</span>, <span class="ident">ExportConfig</span>};
<span class="kw">use</span> <span class="ident">std::time::Duration</span>;
<span class="kw">use</span> <span class="ident">tonic::metadata</span>::<span class="kw-2">*</span>;

<span class="kw">fn</span> <span class="ident">main</span>() -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span>(), <span class="ident">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="ident">std::error::Error</span> <span class="op">+</span> <span class="ident">Send</span> <span class="op">+</span> <span class="ident">Sync</span> <span class="op">+</span> <span class="lifetime">&#39;static</span><span class="op">&gt;</span><span class="op">&gt;</span> {
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">map</span> <span class="op">=</span> <span class="ident">MetadataMap::with_capacity</span>(<span class="number">3</span>);

    <span class="ident">map</span>.<span class="ident">insert</span>(<span class="string">&quot;x-host&quot;</span>, <span class="string">&quot;example.com&quot;</span>.<span class="ident">parse</span>().<span class="ident">unwrap</span>());
    <span class="ident">map</span>.<span class="ident">insert</span>(<span class="string">&quot;x-number&quot;</span>, <span class="string">&quot;123&quot;</span>.<span class="ident">parse</span>().<span class="ident">unwrap</span>());
    <span class="ident">map</span>.<span class="ident">insert_bin</span>(<span class="string">&quot;trace-proto-bin&quot;</span>, <span class="ident">MetadataValue::from_bytes</span>(<span class="string">b&quot;[binary data]&quot;</span>));

    <span class="kw">let</span> <span class="ident">tracer</span> <span class="op">=</span> <span class="ident">opentelemetry_otlp::new_pipeline</span>()
        .<span class="ident">tracing</span>()
        .<span class="ident">with_exporter</span>(
            <span class="ident">opentelemetry_otlp::new_exporter</span>()
            .<span class="ident">tonic</span>()
            .<span class="ident">with_endpoint</span>(<span class="string">&quot;http://localhost:4317&quot;</span>)
            .<span class="ident">with_timeout</span>(<span class="ident">Duration::from_secs</span>(<span class="number">3</span>))
            .<span class="ident">with_metadata</span>(<span class="ident">map</span>)
         )
        .<span class="ident">with_trace_config</span>(
            <span class="ident">trace::config</span>()
                .<span class="ident">with_sampler</span>(<span class="ident">Sampler::AlwaysOn</span>)
                .<span class="ident">with_id_generator</span>(<span class="ident">IdGenerator::default</span>())
                .<span class="ident">with_max_events_per_span</span>(<span class="number">64</span>)
                .<span class="ident">with_max_attributes_per_span</span>(<span class="number">16</span>)
                .<span class="ident">with_max_events_per_span</span>(<span class="number">16</span>)
                .<span class="ident">with_resource</span>(<span class="ident">Resource::new</span>(<span class="macro">vec!</span>[<span class="ident">KeyValue::new</span>(<span class="string">&quot;service.name&quot;</span>, <span class="string">&quot;example&quot;</span>)])),
        )
        .<span class="ident">install_batch</span>(<span class="ident">opentelemetry::runtime::Tokio</span>)<span class="question-mark">?</span>;

    <span class="kw">let</span> <span class="ident">export_config</span> <span class="op">=</span> <span class="ident">ExportConfig</span> {
        <span class="ident">endpoint</span>: <span class="string">&quot;http://localhost:4317&quot;</span>.<span class="ident">to_string</span>(),
        <span class="ident">timeout</span>: <span class="ident">Duration::from_secs</span>(<span class="number">3</span>),
        <span class="ident">protocol</span>: <span class="ident">Protocol::Grpc</span>
    };

    <span class="kw">let</span> <span class="ident">meter</span> <span class="op">=</span> <span class="ident">opentelemetry_otlp::new_pipeline</span>()
        .<span class="ident">metrics</span>(<span class="ident">tokio::spawn</span>, <span class="ident">tokio_interval_stream</span>)
        .<span class="ident">with_exporter</span>(
            <span class="ident">opentelemetry_otlp::new_exporter</span>()
                .<span class="ident">tonic</span>()
                .<span class="ident">with_export_config</span>(<span class="ident">export_config</span>),
                <span class="comment">// can also config it using with_* functions like the tracing part above.</span>
        )
        .<span class="ident">with_stateful</span>(<span class="bool-val">true</span>)
        .<span class="ident">with_period</span>(<span class="ident">Duration::from_secs</span>(<span class="number">3</span>))
        .<span class="ident">with_timeout</span>(<span class="ident">Duration::from_secs</span>(<span class="number">10</span>))
        .<span class="ident">with_aggregator_selector</span>(<span class="ident">selectors::simple::Selector::Exact</span>)
        .<span class="ident">build</span>();

    <span class="ident">tracer</span>.<span class="ident">in_span</span>(<span class="string">&quot;doing_work&quot;</span>, <span class="op">|</span><span class="ident">cx</span><span class="op">|</span> {
        <span class="comment">// Traced app logic here...</span>
    });

    <span class="prelude-val">Ok</span>(())
}</code></pre></div>
<h2 id="grpc-libraries-comparison"><a href="#grpc-libraries-comparison">Grpc libraries comparison</a></h2>
<p>The table below provides a short comparison between <code>grpcio</code> and <code>tonic</code>, two
of the most popular grpc libraries in Rust. Users can choose between them when
working with otlp and grpc.</p>
<div><table><thead><tr><th>Project</th><th><a href="https://github.com/hyperium/tonic">hyperium/tonic</a></th><th><a href="https://github.com/tikv/grpc-rs">tikv/grpc-rs</a></th></tr></thead><tbody>
<tr><td>Feature name</td><td>–features=default</td><td>–features=grpc-sys</td></tr>
<tr><td>gRPC library</td><td><a href="https://crates.io/crates/tonic"><code>tonic</code></a></td><td><a href="https://crates.io/crates/grpcio"><code>grpcio</code></a></td></tr>
<tr><td>Transport</td><td><a href="https://github.com/hyperium/hyper">hyperium/hyper</a> (Rust)</td><td><a href="https://github.com/grpc/grpc">grpc/grpc</a> (C++ binding)</td></tr>
<tr><td>TLS support</td><td>yes</td><td>yes</td></tr>
<tr><td>TLS optional</td><td>yes</td><td>yes</td></tr>
<tr><td>TLS library</td><td>rustls</td><td>OpenSSL</td></tr>
<tr><td>Supported .proto generator</td><td><a href="https://crates.io/crates/prost"><code>prost</code></a></td><td><a href="https://crates.io/crates/prost"><code>prost</code></a>, <a href="https://crates.io/crates/protobuf"><code>protobuf</code></a></td></tr>
</tbody></table>
</div></div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ExportConfig.html" title="opentelemetry_otlp::ExportConfig struct">ExportConfig</a></div><div class="item-right docblock-short"><p>Configuration for the OTLP exporter.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.OtlpExporterPipeline.html" title="opentelemetry_otlp::OtlpExporterPipeline struct">OtlpExporterPipeline</a></div><div class="item-right docblock-short"><p>Build a OTLP metrics or tracing exporter builder. See functions below to understand
what’s currently supported.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.OtlpPipeline.html" title="opentelemetry_otlp::OtlpPipeline struct">OtlpPipeline</a></div><div class="item-right docblock-short"><p>General builder for both tracing and metrics.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.OtlpTracePipeline.html" title="opentelemetry_otlp::OtlpTracePipeline struct">OtlpTracePipeline</a></div><div class="item-right docblock-short"><p>Recommended configuration for an OTLP exporter pipeline.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.TonicExporterBuilder.html" title="opentelemetry_otlp::TonicExporterBuilder struct">TonicExporterBuilder</a></div><div class="item-right docblock-short"><p>Build a trace exporter that uses <a href="https://github.com/hyperium/tonic">tonic</a> as grpc layer and opentelemetry protocol.</p>
</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Error.html" title="opentelemetry_otlp::Error enum">Error</a></div><div class="item-right docblock-short"><p>Wrap type for errors from this crate.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Protocol.html" title="opentelemetry_otlp::Protocol enum">Protocol</a></div><div class="item-right docblock-short"><p>The communication protocol to use when exporting data.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.SpanExporter.html" title="opentelemetry_otlp::SpanExporter enum">SpanExporter</a></div><div class="item-right docblock-short"><p>OTLP exporter that sends tracing information</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.SpanExporterBuilder.html" title="opentelemetry_otlp::SpanExporterBuilder enum">SpanExporterBuilder</a></div><div class="item-right docblock-short"><p>OTLP span exporter builder.</p>
</div></div></div><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.OTEL_EXPORTER_OTLP_ENDPOINT.html" title="opentelemetry_otlp::OTEL_EXPORTER_OTLP_ENDPOINT constant">OTEL_EXPORTER_OTLP_ENDPOINT</a></div><div class="item-right docblock-short"><p>Target to which the exporter is going to send spans or metrics, defaults to https://localhost:4317.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.OTEL_EXPORTER_OTLP_ENDPOINT_DEFAULT.html" title="opentelemetry_otlp::OTEL_EXPORTER_OTLP_ENDPOINT_DEFAULT constant">OTEL_EXPORTER_OTLP_ENDPOINT_DEFAULT</a></div><div class="item-right docblock-short"><p>Default target to which the exporter is going to send spans or metrics.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.OTEL_EXPORTER_OTLP_TIMEOUT.html" title="opentelemetry_otlp::OTEL_EXPORTER_OTLP_TIMEOUT constant">OTEL_EXPORTER_OTLP_TIMEOUT</a></div><div class="item-right docblock-short"><p>Max waiting time for the backend to process each spans or metrics batch, defaults to 10 seconds.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.OTEL_EXPORTER_OTLP_TIMEOUT_DEFAULT.html" title="opentelemetry_otlp::OTEL_EXPORTER_OTLP_TIMEOUT_DEFAULT constant">OTEL_EXPORTER_OTLP_TIMEOUT_DEFAULT</a></div><div class="item-right docblock-short"><p>Default max waiting time for the backend to process each spans or metrics batch.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.OTEL_EXPORTER_OTLP_TRACES_ENDPOINT.html" title="opentelemetry_otlp::OTEL_EXPORTER_OTLP_TRACES_ENDPOINT constant">OTEL_EXPORTER_OTLP_TRACES_ENDPOINT</a></div><div class="item-right docblock-short"><p>Target to which the exporter is going to send spans, defaults to https://localhost:4317.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.OTEL_EXPORTER_OTLP_TRACES_TIMEOUT.html" title="opentelemetry_otlp::OTEL_EXPORTER_OTLP_TRACES_TIMEOUT constant">OTEL_EXPORTER_OTLP_TRACES_TIMEOUT</a></div><div class="item-right docblock-short"><p>Max waiting time for the backend to process each spans batch, defaults to 10s.</p>
</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.HasExportConfig.html" title="opentelemetry_otlp::HasExportConfig trait">HasExportConfig</a></div><div class="item-right docblock-short"><p>Provide access to the export config field within the exporter builders.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.WithExportConfig.html" title="opentelemetry_otlp::WithExportConfig trait">WithExportConfig</a></div><div class="item-right docblock-short"><p>Expose methods to override export configuration.</p>
</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.new_exporter.html" title="opentelemetry_otlp::new_exporter fn">new_exporter</a></div><div class="item-right docblock-short"><p>Create a builder to build OTLP metrics exporter or tracing exporter.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.new_pipeline.html" title="opentelemetry_otlp::new_pipeline fn">new_pipeline</a></div><div class="item-right docblock-short"><p>Create a new pipeline builder with the recommended configuration.</p>
</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="opentelemetry_otlp" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.63.0 (4b91a6ea7 2022-08-08)" ></div>
</body></html>